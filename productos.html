<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OnlyPan Store ‚Äì Productos</title>

<style>
body{
  margin:0;
  font-family: Inter, system-ui;
  background:#f7ebdd;
  color:#2b2b2b;
}

/* Contenedor */
.wrapper{
  max-width:1100px;
  margin:auto;
  padding:20px;
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

header h1{
  font-size:26px;
  font-weight:700;
}

.btn{
  background:#d4a06e;
  color:white;
  padding:8px 20px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-size:15px;
}
.btn:hover{opacity:.85}

/* Input */
.input{
  width:100%;
  padding:10px;
  border:2px solid #d4a06e;
  border-radius:8px;
  margin-top:5px;
  font-size:16px;
}

.grid{
  margin-top:20px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
  gap:20px;
}

.card{
  background:white;
  border-radius:12px;
  padding:15px;
  position:relative;
  box-shadow:0 5px 15px #0001;
}

.card img{
  width:100%;
  border-radius:10px;
  margin-bottom:10px;
}

.card h3{
  margin:0 0 5px 0;
  font-size:18px;
}

.card p{
  margin:0;
  opacity:.85;
}

/* Botones admin sobre la tarjeta */
.row-actions{
  position:absolute;
  top:10px;
  right:10px;
  display:flex;
  gap:7px;
}

.iconbtn{
  background:white;
  border:1px solid #0003;
  padding:5px 7px;
  border-radius:6px;
  cursor:pointer;
  font-size:16px;
}
.iconbtn:hover{background:#eee}
.iconbtn.danger{border-color:#c44;color:#c44}

/* MODAL */
.modal{
  position:fixed; inset:0;
  display:none;              /* Oculto de f√°brica */
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.28);
  backdrop-filter:blur(3px);
  z-index:2000;
}
.modal.open{ display:flex; }

.sheet{
  background:white;
  border-radius:15px;
  padding:20px;
  width:min(600px,92vw);
  box-shadow:0 5px 20px #0003;
}

.sheet header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}

.sheet h3{margin:0;}

/* Mobile */
@media(max-width:600px){
  header h1{font-size:22px;}
  .grid{grid-template-columns:1fr;}
}
</style>

</head>
<body>

<div class="wrapper">

<header>
  <button onclick="location.href='index.html'" class="btn">‚Üê Volver</button>
  <h1>Todos los productos</h1>
  <button id="adminToggle" class="btn">Admin</button>
</header>

<p>Cat√°logo completo. Para editar necesit√°s acceso Admin.</p>

<input id="search" class="input" placeholder="Buscar‚Ä¶">

<div id="grid" class="grid"></div>

</div>

<!-- ‚úÖ MODAL LOGIN -->
<div class="modal" id="loginModal">
  <div class="sheet">
    <header>
      <h3>Iniciar sesi√≥n (Admin)</h3>
      <button id="closeLogin" class="iconbtn">‚úï</button>
    </header>

    <label>Email</label>
    <input id="auth_email" class="input" type="email" placeholder="tuemail@dominio.com">

    <label style="margin-top:10px;">Contrase√±a</label>
    <input id="auth_password" class="input" type="password" placeholder="********">

    <button id="loginBtn" class="btn" style="margin-top:15px;width:100%;">Entrar</button>
  </div>
</div>

<!-- ‚úÖ MODAL EDITOR -->
<div class="modal" id="editModal">
  <div class="sheet">
    <header>
      <h3>Editar Producto</h3>
      <button id="closeEdit" class="iconbtn">‚úï</button>
    </header>

    <label>T√≠tulo</label>
    <input id="edit_titulo" class="input">

    <label style="margin-top:10px;">Imagen (URL)</label>
    <input id="edit_img" class="input">

    <label style="margin-top:10px;">Descripci√≥n</label>
    <input id="edit_desc" class="input">

    <label style="margin-top:10px;">Tags (separados por coma)</label>
    <input id="edit_tags" class="input">

    <button id="saveEdit" class="btn" style="margin-top:15px;width:100%;">Guardar cambios</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
// ‚úÖ CONFIGUR√Å ESTO CON TU SUPABASE
const SUPABASE_URL = "https://dlmgvrejatqhjhxoejdm.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsbWd2cmVqYXRxaGpoeG9lamRtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0NzM4MTcsImV4cCI6MjA3ODA0OTgxN30.5WfDT6qUBfXvvon-io4g-JntQ_EnptAUFyeue1v8tBc";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let session = null;
let EDITING_ID = null;

const grid = document.getElementById("grid");
const search = document.getElementById("search");

const loginModal = document.getElementById("loginModal");
const editModal = document.getElementById("editModal");

const adminToggle = document.getElementById("adminToggle");

// ‚úÖ FUNCIONES MODAL
function openLogin(){
  loginModal.style.display="flex";
  loginModal.classList.add("open");
}
function closeLogin(){
  loginModal.classList.remove("open");
  loginModal.style.display="none";
}

function openEdit(){
  editModal.style.display="flex";
  editModal.classList.add("open");
}
function closeEdit(){
  editModal.classList.remove("open");
  editModal.style.display="none";
  EDITING_ID = null;
}

// ‚úÖ EVENTOS BOTONES MODAL
document.getElementById("closeLogin").onclick = closeLogin;
document.getElementById("closeEdit").onclick = closeEdit;

document.getElementById("adminToggle").onclick = async ()=>{
  if(session){
    await sb.auth.signOut();
    session = null;
    adminToggle.textContent = "Admin";
    loadProducts();
  } else {
    openLogin();
  }
};

// ‚úÖ LOGIN
document.getElementById("loginBtn").onclick = async ()=>{
  const email = document.getElementById("auth_email").value;
  const pass  = document.getElementById("auth_password").value;

  const { data, error } = await sb.auth.signInWithPassword({
    email, password: pass
  });

  if(error){ alert("Credenciales incorrectas"); return; }

  session = data.session;
  adminToggle.textContent = "Cerrar sesi√≥n (Admin)";
  closeLogin();
  loadProducts();
};

// ‚úÖ CARGAR PRODUCTOS
async function loadProducts(){
  const { data } = await sb.from("productos").select("*").order("created_at", { ascending:false });

  render(data);
}

// ‚úÖ RENDER
function render(list){
  let filtro = search.value.toLowerCase();

  const filtrados = list.filter(p =>
    p.titulo.toLowerCase().includes(filtro) ||
    p.desc.toLowerCase().includes(filtro)
  );

  grid.innerHTML = filtrados.map(p=>`
    <div class="card">
      ${session ? `
        <div class="row-actions">
          <button class="iconbtn" onclick="editProduct('${p.id}')">‚úèÔ∏è</button>
          <button class="iconbtn danger" onclick="deleteProduct('${p.id}')">üóëÔ∏è</button>
        </div>
      ` : ""}

      <img src="${p.img}">
      <h3>${p.titulo}</h3>
      <p>${p.desc}</p>
    </div>
  `).join("");
}

search.oninput = loadProducts;

// ‚úÖ EDITAR PRODUCTO
async function editProduct(id){
  EDITING_ID = id;

  const { data } = await sb.from("productos").select("*").eq("id", id).single();

  document.getElementById("edit_titulo").value = data.titulo;
  document.getElementById("edit_img").value    = data.img;
  document.getElementById("edit_desc").value   = data.desc;
  document.getElementById("edit_tags").value   = data.tags.join(",");

  openEdit();
}

// ‚úÖ GUARDAR EDICI√ìN
document.getElementById("saveEdit").onclick = async ()=>{
  if(!EDITING_ID) return;

  const nuevo = {
    titulo: document.getElementById("edit_titulo").value,
    img: document.getElementById("edit_img").value,
    desc: document.getElementById("edit_desc").value,
    tags: document.getElementById("edit_tags").value.split(",").map(t=>t.trim())
  };

  await sb.from("productos").update(nuevo).eq("id", EDITING_ID);

  closeEdit();
  loadProducts();
};

// ‚úÖ ELIMINAR PRODUCTO
async function deleteProduct(id){
  if(!confirm("¬øEliminar producto?")) return;

  await sb.from("productos").delete().eq("id", id);
  loadProducts();
}

// ‚úÖ SESI√ìN ACTUAL
sb.auth.getSession().then(({ data })=>{
  session = data.session;
  if(session) adminToggle.textContent = "Cerrar sesi√≥n (Admin)";
  loadProducts();
});

</script>

</body>
</html>
